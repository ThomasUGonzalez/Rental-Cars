<div class="rental-list-container">
  <h2>Alquileres</h2>

  <div *ngIf="loading" class="loading-shade">
    <mat-spinner></mat-spinner>
    <p>Cargando alquileres...</p>
  </div>

  <div *ngIf="!loading && error" class="no-data error">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!loading && rentals.length === 0 && !error" class="no-data">
    <mat-icon>sentiment_dissatisfied</mat-icon>
    <p>No hay alquileres para mostrar.</p>
  </div>

  <div *ngIf="!loading" class="rentals-grid">
    <mat-card *ngFor="let r of rentals" class="rental-card mat-elevation-z2">
      <mat-card-title>Alquiler #{{ r.id }}</mat-card-title>

      <mat-card-content>
        <p><strong>Auto:</strong> {{ r.car?.brand }} {{ r.car?.model }}</p>
        <p><strong>Usuario:</strong> {{ r.user?.name || r.userId || '-' }}</p>
        <p><strong>Inicio:</strong> {{ r.startDate ? (r.startDate | date:'dd/MM/yyyy') : '-' }}</p>
        <p><strong>Fin:</strong> {{ r.endDate ? (r.endDate | date:'dd/MM/yyyy') : '-' }}</p>
        <p><strong>Precio:</strong> {{ (r.price != null ? r.price : r.car?.price) != null ? ((r.price != null ? r.price : r.car?.price) | currency:'ARS':'ARS$':'1.0-0') : '-' }}</p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" [routerLink]="['/car/detail', r.car?.id]">Ver Auto</button>
        <span class="spacer"></span>
        <button *ngIf="(isAdmin$ | async)" mat-icon-button [routerLink]="['/rentals', r.id, 'edit']" matTooltip="Editar">
          <mat-icon>edit</mat-icon>
        </button>
        <button *ngIf="(isAdmin$ | async)" mat-icon-button (click)="openDeleteModal(r)" matTooltip="Eliminar">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <app-confirm-modal
    #confirmModal
    id="deleteRentalModal"
    title="Confirmar Eliminación"
    [body]="'¿Estás seguro de que quieres eliminar el alquiler #' + (rentalToDelete?.id || '') + '?'"
    confirmButtonText="Sí, Eliminar"
    confirmButtonClass="btn-danger"
    (confirm)="confirmDelete()"
    (close)="rentalToDelete = null">
  </app-confirm-modal>
</div>
