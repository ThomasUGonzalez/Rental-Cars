<div class="table-container">
  <div class="table-header">
    <h2>Detalles del Vehículo</h2>
    <button mat-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Volver al listado
    </button>
  </div>

  <div *ngIf="loading" class="loading-shade">
    <mat-spinner></mat-spinner>
  </div>

  <mat-card *ngIf="car && !loading" class="detail-card mat-elevation-z4">
    <mat-card-header>
      <mat-card-title>{{ car.brand }} {{ car.model }}</mat-card-title>
      <mat-card-subtitle>{{ car.year }} &middot; {{ car.color }}</mat-card-subtitle>
    </mat-card-header>

    <img mat-card-image [src]="car.imageUrl" [alt]="car.brand" class="detail-image">

    <mat-card-content>
      <div class="stats-grid">
         <div class="stat-item">
          <span class="stat-label">Color: </span>
          <span class="stat-value">{{ car.color }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Año: </span>
          <span class="stat-value">{{ car.year }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Precio / día: </span>
          <span class="stat-value">{{ car.price | currency:'ARS':'ARS$':'1.0-0' }}</span>
        </div>
         <div class="stat-item">
          <span class="stat-label">Disponibilidad: </span>
          <span class="stat-value" [class.available]="car.available" [class.rented]="!car.available">
            {{ car.available ? 'Disponible' : 'Alquilado' }}
          </span>
        </div>
      </div>

      <mat-divider class="divider"></mat-divider>

      <div *ngIf="car.available; else rentedMessage" class="rental-section">
        <h3>Realizar Alquiler</h3>
        <form [formGroup]="rentalForm" class="rental-form">
          <mat-form-field appearance="outline">
            <mat-label>Fecha de Inicio</mat-label>
            <input matInput [matDatepicker]="pickerStart" formControlName="startDate" [min]="minDate" (dateChange)="calculatePrice()">
            <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
            <mat-datepicker #pickerStart></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Fecha de Fin</mat-label>
            <input matInput [matDatepicker]="pickerEnd" formControlName="endDate" [min]="minDate" (dateChange)="calculatePrice()">
            <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
            <mat-datepicker #pickerEnd></mat-datepicker>
          </mat-form-field>
        </form>

        <div *ngIf="calculatedPrice && calculatedPrice > 0" class="price-summary">
          <h4>Precio Total Estimado:</h4>
          <span class="total-price">{{ calculatedPrice | currency:'ARS':'ARS$':'1.0-0' }}</span>
        </div>

        <button mat-raised-button color="accent" 
                (click)="confirmRental()" 
                [disabled]="loadingRental || rentalForm.invalid || !calculatedPrice || calculatedPrice <= 0"
                class="rental-button">
          <mat-icon>calendar_today</mat-icon>
          {{ loadingRental ? 'Procesando...' : 'Confirmar Alquiler' }}
        </button>
      </div>

      <ng-template #rentedMessage>
        <div class="rented-message">
          <mat-icon>warning</mat-icon>
          <p>Este vehículo no se encuentra disponible actualmente.</p>
        </div>
      </ng-template>

    </mat-card-content>
  </mat-card>

  <div *ngIf="!car && !loading" class="no-data">
    <mat-icon>search_off</mat-icon>
    <p>No se encontró el vehículo solicitado.</p>
  </div>
</div>