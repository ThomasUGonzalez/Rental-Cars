<div class="catalog-container">
  <div class="catalog-header">
    <h2>Inventario de Vehículos</h2>
    <div class="header-actions">
      <button *ngIf="isAdmin$ | async" mat-raised-button color="accent" routerLink="/car/new" class="add-button">
        <mat-icon>add_circle</mat-icon>
        <span>Añadir Vehículo</span>
      </button>
    </div>
  </div>

  <mat-card class="filter-card mat-elevation-z2">
    <form [formGroup]="filterForm" class="filter-form">
      <mat-form-field appearance="outline" class="filter-search">
        <mat-label>Buscar por marca, modelo, año...</mat-label>
        <input matInput formControlName="searchText">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      <mat-checkbox formControlName="showAvailableOnly" color="primary">
        Mostrar solo disponibles
      </mat-checkbox>
    </form>
  </mat-card>

  <div *ngIf="loading" class="loading-shade">
    <mat-spinner></mat-spinner>
    <p>Cargando inventario...</p>
  </div>

  <div *ngIf="!loading && error" class="no-data error">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!loading && filteredCars.length === 0 && !error" class="no-data">
    <mat-icon>sentiment_dissatisfied</mat-icon>
    <p>{{ allCars.length > 0 ? 'No se encontraron autos con esos filtros.' : 'No se encuentran vehículos registrados.' }}</p>
  </div>

  <div *ngIf="!loading && filteredCars.length > 0" class="catalog-grid">
    
    <mat-card *ngFor="let car of filteredCars" class="car-card mat-elevation-z4" [class.car-rented]="!car.available">
      
      <mat-chip-listbox *ngIf="!car.available" class="rented-badge">
        <mat-chip color="warn" selected>Alquilado</mat-chip>
      </mat-chip-listbox>

      <img mat-card-image [src]="car.imageUrl" [alt]="car.brand + ' ' + car.model">
      
      <mat-card-header>
        <mat-card-title>{{ car.brand }} {{ car.model }}</mat-card-title>
        <mat-card-subtitle>{{ car.year }} &middot; {{ car.color }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <p class="car-price">{{ car.price | currency:'ARS':'ARS$':'1.0-0' }} / día</p>
      </mat-card-content>
      
      <mat-card-actions>
        <button mat-button color="primary" [routerLink]="['/car/detail', car.id]">
          <mat-icon>visibility</mat-icon>
          {{ car.available ? 'Ver y Alquilar' : 'Ver Detalles' }}
        </button>
        <span class="spacer"></span>
        
        <ng-container *ngIf="isAdmin$ | async">
          <button mat-icon-button color="primary" [routerLink]="['/car', car.id, 'edit']" matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="openDeleteModal(car)" matTooltip="Eliminar">
            <mat-icon>delete</mat-icon>
          </button>
        </ng-container>

      </mat-card-actions>
    </mat-card>

  </div>

  <app-confirm-modal
    #confirmModal
    id="deleteCarModal"
    title="Confirmar Eliminación"
    [body]="'¿Estás seguro de que quieres eliminar el auto ' + (carToDelete?.brand || '') + ' ' + (carToDelete?.model || '') + '?'"
    confirmButtonText="Sí, Eliminar"
    confirmButtonClass="btn-danger"
    (confirm)="confirmDelete()"
    (close)="onModalClose()">
  </app-confirm-modal>
</div>